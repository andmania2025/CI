---
description: 管理画面アプリケーションの開発ガイドライン、ルール、およびパターン
globs: ["apps/admin/**/*"]
alwaysApply: false
---

### フロントエンドおよびベースルールの拡張

このファイルは `01_base.mdc` と `02_frontend.mdc` を拡張します。フロントエンドルールで定義されているすべてのコンポーネント設計原則、スタイリングガイドライン、および状態管理ルールに従ってください。

### 管理アプリのコンテキスト

あなたは **管理ダッシュボードアプリケーション** を開発しています。以下に焦点を当ててください：

- 効率的なインターフェースによるデータ管理とCRUD操作
- システム分析、レポート作成、ビジネスインテリジェンス
- ユーザー管理、モデレーション、カスタマーサポートツール
- コンテンツ管理とシステム設定
- ロールベースのアクセス制御（RBAC）と包括的な監査ログ
- キーボードショートカットと一括操作によるパワーユーザーワークフロー

### 管理アプリ固有のルール

#### 認証と認可 (02_frontend.mdcを拡張)

- 強化されたセキュリティ（2FA）による個別の管理認証を実装
- 階層的な権限を持つ包括的なロールベースアクセス制御（RBAC）を使用
- ルートと個々のコンポーネントの両方に権限ガードを作成
- セキュリティのための自動ログアウト付きセッション管理を実装
- 監査コンプライアンスのためにすべての管理操作をログに記録

#### データ管理とCRUD操作

- 02_frontend.mdcのフォームパターンに従って包括的なCRUDインターフェースを作成
- サーバーサイドバリデーションを含むすべての管理フォームにReact Hook Form + Zodを使用
- UX向上のためにTanStack Queryによる楽観的更新を実装
- 効率化のために一括操作（一括削除、更新、エクスポート）を追加
- 高度なフィルタリングと並べ替え機能を作成
- 適切な場合にリアルタイムデータ更新を実装

#### テーブルとリスト管理

- すべての管理インターフェースで一貫したデータテーブルパターンを使用
- 大規模なデータセット（>1000アイテム）に対して仮想スクロールを実装
- カラムのカスタマイズ（表示/非表示、並べ替え、サイズ変更）を追加
- 複数の形式をサポートするエクスポート可能なデータテーブルを作成
- パワーユーザー向けに保存済みフィルタープリセットを実装
- テーブルのキーボードナビゲーション（矢印キー、Enter、Escape）を追加

#### アナリティクスとレポート

- 主要なビジネス指標を含む包括的なダッシュボードを構築
- rechartsライブラリを使用してインタラクティブなチャートを作成
- 適用可能な場所にリアルタイムのメトリック更新を実装
- レポートのスケジューリングと自動メール配信を追加
- カスタムレポートビルダーインターフェースを作成
- データドリルダウン機能を実装

#### 一括操作とパワーユーザー機能

- 破壊的な操作に対する確認ダイアログ付きの一括アクションを実装
- 一般的な管理タスク用のキーボードショートカットを追加（コマンドパレット用 Cmd+K）
- 重要な操作に対する元に戻す/やり直し（undo/redo）機能を作成
- クイックアクションとバッチ処理を実装
- 長時間実行される操作に進捗インジケーターを追加

#### パフォーマンスとスケーラビリティ

- 大規模なデータテーブルに仮想スクロールを使用
- 無限スクロールオプションを備えた適切なページネーションを実装
- 重い管理コンポーネントに戦略的にReact.memoを使用
- TanStack Queryによる適切なキャッシュ戦略を実装
- すべてのデータ量の多いインターフェースにローディングスケルトンを追加

#### 管理者向けユーザーエクスペリエンス

- インターフェース全体にコンテキストヘルプとツールチップを作成
- 深いページ階層に対してパンくずリストナビゲーションを実装
- クイックナビゲーションとアクションのためにコマンドパレット（Cmd+K）を追加
- システムアラートと更新のための通知センターを作成
- 回復アクションを伴う適切なエラー状態を実装

#### セキュリティと監査

- ユーザー、タイムスタンプ、変更詳細を含むすべての管理操作をログに記録
- 管理APIエンドポイントにレート制限を実装
- 管理アクセス用のIPホワイトリスト機能を追加
- 検索とフィルタリング機能を備えた監査証跡ビューアを作成
- 監査ログのデータ保持ポリシーを実装

#### コンポーネントパターン (02_frontend.mdcを拡張)

- フロントエンドルールのSRP（単一責任の原則）とコンポジションパターンに従う
- 管理固有のキャッシュ戦略を持つすべてのサーバー状態にTanStack Queryを使用
- 管理固有のグローバル状態（権限、UI設定）にZustandを使用
- アプリケーション全体で権限ベースのレンダリングを実装
- 再利用可能な管理固有コンポーネント（データテーブル、フォーム、チャート）を作成
- React 19の強化された並行機能と自動バッチ処理を活用
- データ取得にReact 19の改良されたuse()フックを活用

#### フォーム処理 (02_frontend.mdcに従う)

- 常にReact Hook FormとZodバリデーションを使用
- 管理固有のフォームコンポーネント（FormBuilder, FormWizard）を作成
- サーバーサイド確認を伴う適切なバリデーションを実装
- 長いフォームに自動保存機能を追加
- 一般的な管理操作用のフォームテンプレートを作成

### 管理固有の命名規則

- ルートファイル: `kebab-case` （例：`user-management/page.tsx`）
- コンポーネント: `PascalCase` （例：`UserTable.tsx`） - 02_frontend.mdcに従う
- フック: `camelCase` で接頭辞 `use` - 02_frontend.mdcに従う
- ストアファイル: `camelCase` で接尾辞 `Store` （例：`adminAuthStore.ts`）
- クエリファイル: `camelCase` で接尾辞 `Queries` （例：`usersQueries.ts`）
- 権限定数: `SCREAMING_SNAKE_CASE` （例：`USER_MANAGEMENT_READ`）

### 管理固有のパターン

#### 権限ベースのレンダリング

```typescript
// 管理インターフェース全体で一貫して権限ガードを使用
<PermissionGuard permission="users.edit" fallback={<ReadOnlyView />}>
  <EditUserButton />
</PermissionGuard>
```

#### データテーブルパターン

```typescript
// 管理インターフェース全体で一貫したテーブル実装
interface AdminTableProps<T> {
  data: T[];
  columns: ColumnDef<T>[];
  isLoading?: boolean;
  onRowSelect?: (rows: T[]) => void;
  onBulkAction?: (action: string, rows: T[]) => void;
  onExport?: (format: "csv" | "xlsx" | "pdf") => void;
  enableSearch?: boolean;
  enableFilters?: boolean;
}
```

#### 一括アクションパターン

```typescript
// 管理機能全体で一貫した一括操作を実装
const { selectedRows, bulkDelete, bulkUpdate, bulkExport } = useBulkActions({
  onSuccess: () => queryClient.invalidateQueries(["admin", entityType]),
  confirmationRequired: true,
  auditLog: true,
});
```

#### 監査ログパターン

```typescript
// すべての管理操作に対する一貫した監査ログ
const { logAction } = useAuditLog();

const handleUserUpdate = async (userId: string, data: UserUpdateData) => {
  const result = await updateUser(userId, data);
  await logAction("USER_UPDATED", { userId, changes: data });
  return result;
};
```

### 統合ノート

- このファイルは `01_base.mdc` および `02_frontend.mdc` と連携して動作します
- コンポーネント設計ルール、スタイリングガイドライン、または状態管理パターンを複製しないでください
- 管理固有のワークフローに焦点を当ててください：データ管理、アナリティクス、ユーザー管理、システム設定
- すべての一般的なフロントエンドパターンは `02_frontend.mdc` で処理されます
- セキュリティと監査ログは管理インターフェースにとって重要です
